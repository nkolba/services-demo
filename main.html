<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Layout Manager Tutorial</title>
    <script src="main-bundle.js"></script>
    <link href="main.css" rel="stylesheet">
</head>

<body>
    <ul>
    <li id="restore">restore a Layout</li> 
    <li id="save">save a Layout</li>
    <li id="deregister">deregister windows</li>
    <li id="undock">undock windows</li>
    <li id="ungroup">undock groups</li>
    <li>create tab ui</li>
</ul>
</body>
<script>



async function positionWindow(win) {
    try {
        const ofWin = await fin.Window.wrap(win);
        await ofWin.leaveGroup();
        await ofWin.setBounds(win);

        // COMMENTED OUT FOR DEMO
        if (win.state === 'normal') {
            await ofWin.restore();
        } else if (win.state === 'minimized') {
            await ofWin.minimize();
        } else if (win.state === 'maximized') {
            await ofWin.maximize();
        }

        if (win.isShowing) {
            await ofWin.show();
        } else {
            await ofWin.hide();
        }
    } catch (e) {
        console.error('position window error', e);
    }
}

async function openChild(name, url) {
    const win = fin.Window.create({
        url: url,
        autoShow: true,
        saveWindowState: false,
        frame: !(url && url.includes('frameless')),
        name
    });
    return win;
}

 async function appRestore(layoutApp) {
        const ofApp = await fin.Application.getCurrent();
        const openWindows = await ofApp.getChildWindows();
        const openAndPosition = layoutApp.childWindows.map(async (win, index) => {
        if(!openWindows.some(w => w.identity.name === win.name)) {
            const ofWin = await openChild(win.name, win.info.url);
            await positionWindow(win);
        } else {
            await positionWindow(win);
        }
        });
        await Promise.all(openAndPosition);
        return layoutApp;
    };

    Layouts.onWillSaveAppLayout(layoutApp => {return layoutApp;});

    Layouts.onAppRestore(appRestore);

    document.addEventListener("DOMContentLoaded",function(){
        document.getElementById("undock").addEventListener("click",function(){
            let win = new fin.desktop.Window({name:"undockWin",
            url:"undock-win.html",
            defaultHeight:600,
            defaultWidth:400},
            function(){win.show();},
            function(e){console.log(e);});
        });

        document.getElementById("ungroup").addEventListener("click",function(){
            let win = new fin.desktop.Window({name:"ungroupWin",
            url:"ungroup-win.html",
            defaultHeight:600,
            defaultWidth:400},
            function(){win.show();},
            function(e){console.log(e);});
        });

        document.getElementById("deregister").addEventListener("click",function(){
            let win = new fin.desktop.Window({name:"deregisterWin",
            url:"deregister-win.html",
            defaultHeight:600,
            defaultWidth:400},
            function(){win.show();},
            function(e){console.log(e);});
        });


        document.getElementById("restore").addEventListener("click",function(){
            Layouts.restoreLayout(snapLayout).then(r => {console.log(r);},e => {console.log(e);});
        });

        document.getElementById("save").addEventListener("click",function(){
            Layouts.generateLayout().then(l => {console.log(JSON.stringify(l));});
        });
    });

</script>
</html>